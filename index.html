<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LangGo | Translate</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }

    .content {
      flex: 1;
      padding: 40px;
    }

    h1 {
      margin-bottom: 10px;
    }

    #translatedWords {
      background: #fffbea;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 12px;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .word {
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 6px;
    }

    .word:hover {
      background-color: #ffe066;
    }

    #translationBox {
      margin-top: 20px;
      background: #f8f8ff;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    .word.translated {
      background-color: #ffe066; /* light yellow */
      font-weight: bold;
    }
    .word.untranslated {
      background-color: #f0f0f0; /* light gray */
      opacity: 0.6;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      margin: 15px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 10px;
    }

    button {
      margin-top: 10px;
      background-color: #ffd700;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      border-radius: 6px;
    }
    button:hover {
      background-color: #f5c400;
    }
  </style>
</head>
<body>
  <div class="container">
    <nav class="sidebar">
      <h2>LangGo</h2>
      <ul>
        <li><a class="active" href="index.html">Translate</a></li>
        <li><a href="add.html">Vocabulary</a></li>
        <li><a href="lyrics.html">Lyrics</a></li>
        <li><a href="flashcard.html">Flashcard</a></li>
        <li><a href="fact.html">Fact</a></li>
      </ul>
    </nav>

    <main class="content">
      <h1>Translate Word</h1>
      <!-- Language selection -->
<div>
  <label>From: 
    <select id="sourceLang">
      <option value="tl">Filipino 🇵🇭</option>
      <option value="en">English 🇬🇧</option>
      <option value="ms">Malay 🇲🇾</option>
      <option value="ko">Korean 🇰🇷</option>
      <option value="de">German 🇩🇪</option>
      <option value="fr">French 🇫🇷</option>
      <option value="zh">Chinese 🇨🇳</option>
      <option value="ja">Japanese 🇯🇵</option>
    </select>
  </label>

  <label>To: 
    <select id="targetLang">
      <option value="en">English 🇬🇧</option>
      <option value="ms">Malay 🇲🇾</option>
      <option value="ko">Korean 🇰🇷</option>
      <option value="tl">Filipino 🇵🇭</option>
      <option value="de">German 🇩🇪</option>
      <option value="fr">French 🇫🇷</option>
      <option value="zh">Chinese 🇨🇳</option>
      <option value="ja">Japanese 🇯🇵</option>
    </select>
  </label>
</div>

        <textarea id="inputText" placeholder="Type your sentence..."></textarea>
        <button onclick="translateText()">Translate</button>
        <div id="translatedWords" class="output"></div>
        <div id="translationBox"></div>
      </div>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, doc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCY685VUp-3SDJZcfbIwRFD20QXKIvyuD8",
      authDomain: "langgo-4bb3a.firebaseapp.com",
      projectId: "langgo-4bb3a",
      storageBucket: "langgo-4bb3a.appspot.com",
      messagingSenderId: "741690694912",
      appId: "1:741690694912:web:027b883b74e5fe217ca7e5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const langList = [
      { code: 'en', label: 'English 🇬🇧' },
      { code: 'ms', label: 'Malay 🇲🇾' },
      { code: 'ko', label: 'Korean 🇰🇷' },
      { code: 'tl', label: 'Filipino 🇵🇭' },
      { code: 'de', label: 'German 🇩🇪' },
      { code: 'fr', label: 'French 🇫🇷' },
      { code: 'zh', label: 'Chinese 🇨🇳' },
      { code: 'ja', label: 'Japanese 🇯🇵' }
    ];

    const outputDiv = document.getElementById("translatedWords");
    const translationBox = document.getElementById("translationBox");

    window.translateText = async () => {
      const input = document.getElementById("inputText").value.trim();
      if (!input) return alert("Please type a sentence.");

      outputDiv.innerHTML = "";
      translationBox.innerHTML = "";

      const translationSnapshot = await getDocs(collection(db, "translations"));
      const wordsMap = {};
      translationSnapshot.forEach(doc => {
        wordsMap[doc.id] = doc.data();
      });

      const formatted = input.split(/(\s+)/).map(part => {
        if (part.trim() === "") return part;
        const cleanWord = part.replace(/[.,!?;:()"'”“]/g, "").toLowerCase();
        let found = false;
        let docId = "";

        for (const [id, data] of Object.entries(wordsMap)) {
          if (Object.values(data).map(v => (v || "").toLowerCase()).includes(cleanWord)) {
            found = true;
            docId = id;
            break;
          }
        }

        const className = found ? "word translated" : "word untranslated";
        return `<span class="${className}" onclick="translateWord('${cleanWord}','${part}')">${part}</span>`;
      }).join("");

      outputDiv.innerHTML = formatted;
    };

    window.translateWord = async (cleanWord, originalWord) => {
  const sourceLang = document.getElementById("sourceLang").value;
  const targetLang = document.getElementById("targetLang").value;

  const querySnapshot = await getDocs(collection(db, "translations"));
  let found = false;
  let docId = "";
  let translationData = null;

  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    // Check if word exists in ANY language array
    for (const [lang, values] of Object.entries(data)) {
      const arr = Array.isArray(values) ? values : [values];
      if (arr.map(v => v.toLowerCase()).includes(cleanWord)) {
        found = true;
        docId = docSnap.id;
        translationData = data;
        break;
      }
    }
  });

  if (found) {
    const targetTranslations = translationData[targetLang];
    const displayText = targetTranslations
      ? (Array.isArray(targetTranslations) ? targetTranslations.join(", ") : targetTranslations)
      : "❌ Not available";

    translationBox.innerHTML = `
      <strong>Word:</strong> ${originalWord}<br>
      <strong>${langList.find(l => l.code === targetLang).label}:</strong> 
      ${displayText}
      <br><br>
      <button onclick="editTranslation('${docId}','${originalWord}')">✏️ Edit</button>
    `;
  } else {
    translationBox.innerHTML = `
      <strong>Word:</strong> ${originalWord}<br>
      ❌ No translation found.<br><br>
      ${langList.map(l => `<label>${l.label}: 
        <input type="text" id="${l.code}-${cleanWord}" placeholder="Separate multiple with commas">
      </label><br>`).join("")}
      <br><button onclick="addNewTranslation('${cleanWord}','${originalWord}')">➕ Add Translation</button>
    `;
  }
};

window.editTranslation = async (docId, word) => {
  const docSnap = (await getDocs(collection(db, "translations"))).docs.find(d => d.id === docId);
  if (!docSnap) return;
  const data = docSnap.data();

  translationBox.innerHTML = `
    <strong>Edit Translation for:</strong> ${word}<br><br>
    ${langList.map(l => {
      const values = data[l.code];
      const valueStr = Array.isArray(values) ? values.join(", ") : (values || "");
      return `<label>${l.label}: 
        <input type="text" id="edit-${l.code}" value="${valueStr}" placeholder="Separate multiple with commas">
      </label><br>`;
    }).join("")}
    <br><button onclick="saveTranslation('${docId}')">💾 Save</button>
  `;
};

window.saveTranslation = async (docId) => {
  const updates = {};
  langList.forEach(l => {
    const val = document.getElementById("edit-" + l.code).value.trim();
    updates[l.code] = val ? val.split(",").map(v => v.trim()) : [];
  });
  await setDoc(doc(db, "translations", docId), updates);
  translationBox.innerHTML = "✅ Translation updated!";
};

window.addNewTranslation = async (cleanWord, originalWord) => {
  const data = {};
  langList.forEach(l => {
    const val = document.getElementById(`${l.code}-${cleanWord}`).value.trim();
    data[l.code] = val ? val.split(",").map(v => v.trim()) : [];
  });
  await setDoc(doc(db, "translations", cleanWord), data);
  translationBox.innerHTML = "✅ Translation added!";
};
</script>
</body></html>
